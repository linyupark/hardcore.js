riot.tag2("fp-admin-setting-org",'<header for="admin"></header><main class="admin"><div class="container"><admin-sidenav></admin-sidenav><section><h2>管理后台 &gt; 设置 &gt; 组织机构管理 <span each="{parentList}"> &gt; <a href="javascript:;" class="under-line" onclick="{fn.back}">{name}</a></span></h2><table-filter for="org"><yield to="addon"><button class="main" onclick="{parent.fn.add}"><i class="icon-plus"></i> 添加组织机构 </button></yield></table-filter><table class="base"><thead><tr><th width="20%">编号</th><th width="40%">组织名称</th><th width="20%">排序</th><th width="20%">{app.lang.admin.handle}</th></tr></thead><tbody><tr each="{tableList}"><td>{id}</td><td><a href="javascript:;" onclick="{fn.next}" class="under-line">{name}</a></td><td>{sort}</td><td><a href="javascript:;" aria-label="{app.lang.admin.handles.edit}" class="c-tooltip--top"><i onclick="{fn.edit}" class="btn-icon icon-pencil"></i></a><a href="javascript:;" aria-label="{app.lang.admin.handles.remove}" class="c-tooltip--top"><i onclick="{fn.remove}" class="btn-icon icon-trash"></i></a></td></tr><tr if="{!tableList}"><td colspan="4"><spinner-dot></spinner-dot></td></tr></tbody><tfoot if="{tableList}"><tr><td class="left" colspan="4"> {app.lang.admin.counts.items} <b>{items}</b> {app.lang.admin.counts.unit} </td></tr></tfoot></table><pagination-number page="{page}" pages="{pages}" select="y"></pagination-number></section></div></main><footer class="admin"></footer><modal-confirm type="delete"></modal-confirm><modal ref="saveOrg" w="400" h="260"><yield to="title"> {parent.org.id?\'修改\':\'添加\'}内容 </yield><yield to="content"><form class="modal"><div class="row"><p><label>组织名称</label><input ref="org_name" type="text" riot-value="{parent.org.name}"></p><p><label>排序</label><input ref="org_sort" type="text" riot-value="{parent.org.sort}"><input-valid style="left: 85px" ref="validOrg" for="org_name,org_sort" rule="required" msg="组织名称跟排序都为必填"></input-valid></p></div></form></yield><yield to="button"><button type="button" onclick="{parent.fn.ok}" class="btn-main">{app.lang.admin.btn.ok}</button></yield><yield to="close">{app.lang.admin.btn.cancel}</yield></modal>',"","",function(e){var t=this;t.q=t.app.route.query,t.org={},t.parentList=[{pid:0,name:"一级组织"}],t.fn={remove:function(e){t.tags["modal-confirm"].once("ok",function(){t.app.api("GET","system-setting/organization/delete",{data:{id:e.item.id}}).on("done",function(){t.app.alert("组织机构删除成功","success"),t.fn.getOrgList()})}).emit("open")},back:function(e){var a=t.parentList.indexOf(e.item);0==a&&(a=1),t.parentList.splice(a,t.parentList.length-a),t.fn.getOrgList()},next:function(e){t.parentList.push({pid:e.item.id,name:e.item.name}),t.fn.getOrgList()},ok:function(e){var a=t.org.id?"system-setting/organization/update?id="+t.org.id:"system-setting/organization/create";t.refs.saveOrg.refs.validOrg.once("valid",function(){var n=t.refs.saveOrg.refs.org_sort.value;return!Number(n)||Number(n)<0?this.emit("msg","排序必须为正整数"):void t.app.api("POST",a,{trigger:e.target,data:{data:JSON.stringify({parent_id:t.parentList.slice(-1)[0].pid,name:t.refs.saveOrg.refs.org_name.value,sort:Number(n)})}}).once("done",function(){t.app.alert("操作成功","success"),t.fn.getOrgList(),t.refs.saveOrg.emit("close")})}).emit("check")},edit:function(e){t.org=e.item,t.refs.saveOrg.emit("open"),t.refs.saveOrg.refs.validOrg.emit("msg","")},add:function(){t.org={},t.refs.saveOrg.emit("open"),t.refs.saveOrg.refs.validOrg.emit("msg","")},getOrgList:function(){t.app.api("GET","system-setting/organization/index",{data:{page:t.q.page||1,parent_id:t.parentList.slice(-1)[0].pid}}).on("done",function(e){t.update({tableList:e.items,page:e.counts.page,pages:e.counts.total_page,items:e.counts.total_items}),t.tags["pagination-number"].emit("render")})}},this.on("mount",function(){t.fn.getOrgList(),t.tags["pagination-number"].on("change",function(e){t.q.page=e,t.app.query()})})});