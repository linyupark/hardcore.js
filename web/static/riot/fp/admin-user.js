riot.tag2("user-form",'<section><h2>管理后台 &gt; 用户管理 &gt; {uid?\'修改\':\'新增\'}用户信息</h2><form class="user"><h4>帐号及权限</h4><div class="c2"><div class="row"><p><label style="text-align: center;">帐号</label><input type="text" ref="username" riot-value="{user.username}" placeholder="数字或字母或下划线，长度6-16"><input-valid ref="validOnSave" for="username" reg="^[\\d|\\w|\\_]\\{6,16\\}$" msg="数字或字母或下划线，长度6-16"></input-valid></p></div><div class="row"><p><label style="text-align: center;">密码</label><input type="text" ref="password" riot-value="{user.password}" placeholder="6-20个英文字母数字或符号，不能纯数字"><input-valid if="{uid}" ref="validOnSave" for="password" reg="^$|^(?!\\d+$).\\{6,20\\}$" msg="6-20个英文字母数字或符号，不能纯数字"></input-valid><input-valid if="{!uid}" ref="validOnSave" for="password" reg="^(?!\\d+$).\\{6,20\\}$" msg="6-20个英文字母数字或符号，不能纯数字"></input-valid></p><p><label>确认密码</label><input type="text" ref="confirm_password" value="" placeholder="跟密码保持一致"><input-valid if="{uid}" ref="validCFPassword" for="confirm_password" reg="^$|^(?!\\d+$).\\{6,20\\}$" msg=""></input-valid><input-valid if="{!uid}" ref="validCFPassword" for="confirm_password" reg="^(?!\\d+$).\\{6,20\\}$" msg=""></input-valid></p></div><div class="row"><p><label>角色权限</label><role-select ref="role"></role-select></p><p><label>所属捐赠方</label><donor-select ref="donor"></donor-select></p></div><div class="row c4"><p style="width: 100%"><label>组织结构</label><org-select ref="organization"></org-select></p></div><div class="row"><p><label>项目后台</label><input id="is_manager" ref="is_manager" style="vertical-align: middle" type="checkbox" checked="{user.is_manager==1}"><label for="is_manager" style="width: 50%; margin-left:10px;"> 允许进入项目管理后台 </label></p></div></div><hr><br><h4>个人信息</h4><div class="c2"><div class="row"><p><label style="text-align: center">姓名</label><input type="text" ref="real_name" riot-value="{user.real_name}" placeholder="必填"><input-valid ref="validOnSave" for="real_name" rule="required" msg="必填"></input-valid></p><p><label style="text-align: center">性别</label><select ref="sex"><option value="1" selected="{user.sex==1}">男</option><option value="0" selected="{user.sex==0}">女</option></select></p></div><div class="row"><p><label style="text-align: center">职务</label><place-select ref="place"></place-select></p><p><label style="text-align: center">电话</label><input ref="tel" type="text" riot-value="{user.tel}"></p></div><div class="row"><p><label>公司名称</label><input ref="company" type="text" riot-value="{user.company}"></p><p><label>公司电话</label><input ref="company_tel" type="text" riot-value="{user.company_tel}"></p></div><div class="row"><p><label style="text-align: center">传真</label><input ref="company_fax" type="text" riot-value="{user.company_fax}"></p><p><label>电子邮箱</label><input ref="email" type="text" riot-value="{user.email}"></p></div><div class="row"><p><label style="text-align: center">微信号</label><input ref="we_chat" type="text" riot-value="{user.we_chat}"></p><p><label style="text-align: center">QQ</label><input ref="qq" type="text" riot-value="{user.qq}"></p></div></div><div class="row c4"><p style="width: 100%"><label>通讯地址</label><input ref="address" type="text" riot-value="{user.address}" style="width: 71.5%"></p></div><div class="c1"><label class="top">个人介绍</label><p><textarea ref="profile">{user.profile}</textarea></p></div><div class="c1 btn-line"><button type="button" onclick="{fn.save}" class="btn-yellow">{app.lang.admin.btn.save}</button><button type="button" onclick="{fn.cancel}" class="btn-gray">{app.lang.admin.btn.back}</button></div></form></section>',"","",function(e){var t=this;t.user={},t.uid=t.app.route.params[2],t.fn={cancel:function(){history.back()},save:function(e){var a="user-manager/default/create";t.uid&&(a="user-manager/default/update?id="+t.uid),t.app.validAll(t.refs.validOnSave).then(function(){return t.refs.confirm_password.value!=t.refs.password.value?(t.refs.validCFPassword.emit("check").emit("msg","确认密码与密码不一致"),t.app.alert("请检查表单","warning")):void t.app.api("POST",a,{trigger:e.target,data:{data:JSON.stringify({address:t.refs.address.value,company:t.refs.company.value,company_fax:t.refs.company_fax.value,company_tel:t.refs.company_tel.value,password:t.refs.password.value,confirm_password:t.refs.confirm_password.value,donor_id:t.refs.donor.getId(),email:t.refs.email.value,is_manager:t.refs.is_manager.checked?1:0,organization_id:t.refs.organization.getId(),place_id:t.refs.place.getId(),profile:t.refs.profile.value,qq:t.refs.qq.value,real_name:t.refs.real_name.value,role_name:t.refs.role.getName(),sex:t.refs.sex.value,tel:t.refs.tel.value,username:t.refs.username.value,we_chat:t.refs.we_chat.value})}}).on("done",function(){t.app.alert("用户信息保存成功","success"),!t.uid&&t.app.route("admin-user")})}).catch(function(){t.app.alert("请检查表单","warning")})},getUserDetail:function(){t.app.api("GET","user-manager/default/update",{data:{id:t.uid}}).on("done",function(e){t.update({user:e}),t.refs.donor.emit("set",{id:e.donor_id,name:e.donor_name}),t.refs.role.emit("set",{name:e.role_name,description:e.role_description}),t.refs.organization.trap("set",e.organization_id),t.refs.place.emit("set",{id:e.place_id,name:e.place_name})})}},t.on("mount",function(){t.uid&&t.fn.getUserDetail()})}),riot.tag2("fp-admin-user",'<header for="admin"></header><main class="admin"><div class="container"><admin-sidenav></admin-sidenav><user-form if="{section==\'add\'}"></user-form><user-form if="{section==\'edit\'}"></user-form><section if="{section==\'index\'}"><h2>管理后台 &gt; 用户管理</h2><table-filter for="user"><yield to="addon"><button class="main" onclick="{parent.fn.add}"><i class="icon-plus"></i> 添加用户 </button></yield></table-filter><table class="base"><thead><tr><th width="10%">序号</th><th width="15%">姓名</th><th width="10%">性别</th><th width="20%">系统角色</th><th width="10%">用户类型</th><th width="15%">手机号</th><th width="10%">注册时间</th><th width="10%">{app.lang.admin.handle}</th></tr></thead><tbody><tr each="{tableList}"><td>{id}</td><td>{real_name}</td><td>{sex}</td><td>{role_description||\'-\'}</td><td>{is_manager==1?\'管理员\':\'捐赠方\'}</td><td>{tel||\'-\'}</td><td>{app.utils.time2str(created_at)}</td><td><a href="javascript:;" aria-label="{app.lang.admin.handles.edit}" class="c-tooltip--top"><i onclick="{fn.edit}" class="btn-icon icon-pencil"></i></a><a href="javascript:;" aria-label="{app.lang.admin.handles.remove}" class="c-tooltip--top"><i onclick="{fn.remove}" class="btn-icon icon-trash"></i></a></td></tr><tr if="{!tableList}"><td colspan="8"><spinner-dot></spinner-dot></td></tr></tbody><tfoot if="{tableList}"><tr><td class="left" colspan="8"> {app.lang.admin.counts.items} <b>{items}</b> {app.lang.admin.counts.unit} </td></tr></tfoot></table><pagination-number page="{page}" pages="{pages}" select="y"></pagination-number></section></div></main><footer class="admin"></footer><modal-remove></modal-remove>',"","",function(e){var t=this;t.q=t.app.route.query,t.section=t.app.route.params[1]||"index",t.fn={remove:function(e){t.tags["modal-remove"].emit("open").once("ok",function(){t.app.api("GET","user-manager/default/delete",{data:{id:e.item.id}}).on("done",function(){t.app.alert("用户删除成功","success"),t.fn.getUserList()})})},edit:function(e){t.app.route(t.app.route.path+"/edit/"+e.item.id)},add:function(e){t.app.route(t.app.route.path+"/add/")},getUserList:function(){t.app.api("GET","user-manager/default/index",{data:{page:t.q.page||1}}).on("done",function(e){t.update({tableList:e.items,page:e.counts.page,pages:e.counts.total_page,items:e.counts.total_items}),t.tags["pagination-number"].emit("render")})}},this.on("mount",function(){"index"===t.section&&(t.fn.getUserList(),t.tags["pagination-number"].on("change",function(e){t.q.page=e,t.app.query()}))})});