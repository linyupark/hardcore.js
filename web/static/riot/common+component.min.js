riot.tag2("hc-pie-text",'<div class="wrapper"><div ref="pie" riot-style="width: {opts.w}px; height: {opts.h}px"></div><div class="text"><yield></yield></div></div>','hc-pie-text .wrapper,[data-is="hc-pie-text"] .wrapper{position: relative;} hc-pie-text .wrapper .text,[data-is="hc-pie-text"] .wrapper .text{position: absolute;}',"",function(e){var t=this;t.colors={orange:{radialGradient:{cx:.5,cy:.3,r:.7},stops:[[0,"#FF8055"],[1,"#FB6366"]]},blue:{radialGradient:{cx:.5,cy:.3,r:.7},stops:[[0,"#58B6ED"],[1,"#3494F4"]]}},t.fn={},t.on("mount",function(){Highcharts.chart(t.refs.pie,{chart:{type:"solidgauge",backgroundColor:"none"},credits:!1,title:{text:""},pane:{startAngle:0,endAngle:360,background:[{outerRadius:"118%",innerRadius:"88%",backgroundColor:e.bgcolor||"#f3f3f3",borderWidth:0}]},yAxis:{min:0,max:100,lineWidth:0,tickPositions:[]},plotOptions:{solidgauge:{borderWidth:"13px",dataLabels:{enabled:!1},stickyTracking:!1}},tooltip:{enabled:!1},series:[{borderColor:t.colors[e.color||"orange"],data:[{radius:"100%",innerRadius:"100%",y:Number(e.percent)||0}]}]})})}),riot.tag2("tinymce-editor","<textarea></textarea>",'tinymce-editor [aria-label]:hover:after,[data-is="tinymce-editor"] [aria-label]:hover:after,tinymce-editor [aria-label]:focus:after,[data-is="tinymce-editor"] [aria-label]:focus:after{ display: none; }',"",function(e){var t=this;t.getContent=function(){return tinymce.activeEditor.getContent()},t.fn={},t.on("mount",function(){tinymce.init({selector:"textarea",width:e.w,height:e.h,language:"zh_CN",menubar:!1,statusbar:!1,forced_root_block:"",force_br_newlines:!0,force_p_newlines:!1,init_instance_callback:function(e){t.trap("inited",e),e.on("keyup",function(a){var n=e.selection.getRng().getClientRects()[0];t.emit("keyup",a,{edit:e,pos:{x:n&&n.left||0,y:n&&n.top||0}})})}})}),t.on("setContent",function(e){var t=tinymce.activeEditor;t.setContent(e),t.selection.select(t.getBody(),!0),t.selection.collapse(!1),t.focus()}),t.on("insertContent",function(e){tinymce.activeEditor.insertContent(e)})}),riot.tag2("modal-agreement",'<modal ref="modal" w="640" h="520" top="15%"><yield to="title">选择新增协议</yield><yield to="content"><table-filter ref="filter" for="agreement" modal="true"></table-filter><br><table class="base" style="min-height: 255px"><thead><tr><th width="10%">关联</th><th width="30%">{app.lang.admin.project.number}</th><th width="60%">{app.lang.admin.agreement.name}</th></tr></thead><tbody><tr each="{parent.tableList}"><td><input onclick="{parent.parent.fn.addIds}" type="checkbox" checked="{parent.parent.ids.indexOf(id)!=-1}"></td><td>{agreement_number}</td><td class="left">{app.subText(agreement_name, 20)}</td></tr><tr if="{!parent.tableList}"><td colspan="3"><spinner-dot></spinner-dot></td></tr><tr if="{parent.tableList && parent.tableList.length==0}"><td colspan="3">没有可添加关联的协议</td></tr></tbody></table><pagination-number ref="page" page="{parent.page}" pages="{parent.pages}" select="y"></pagination-number></yield><yield to="button"><button type="button" onclick="{parent.fn.addAgreement}" class="btn-main">{app.lang.admin.btn.ok}</button></yield><yield to="close">{app.lang.admin.btn.cancel}</yield></modal>',"","",function(e){var t=this;t.q={},t.ids=[],t.fn={addAgreement:function(){t.app.api("POST","project/agreement/create?id="+e.pid,{data:{data:JSON.stringify(t.ids)}}).on("done",function(e){t.app.alert("协议关联添加成功","success"),t.refs.modal.emit("close"),t.emit("added")})},addIds:function(e){e.target.checked?t.ids.push(e.item.id):t.ids.splice(t.ids.indexOf(e.item.id),1)},getList:function(){t.update({tableList:!1}),t.app.api("GET","project/agreement/search",{data:{page:t.q.page||1,search_type:t.q.type||"",search_keyword:t.q.keyword||"",per_page:5}}).on("done",function(e){t.update({tableList:e.items,page:e.counts.page,pages:e.counts.total_page,items:e.counts.total_items}),t.refs.modal.refs.page&&t.refs.modal.refs.page.emit("render")})}},t.on("mount",function(){t.fn.getList(),t.on("open",function(){t.refs.modal.emit("open"),t.refs.modal.refs.page.on("change",function(e){t.q.page=e,t.fn.getList()}),t.refs.modal.refs.filter.on("query",function(e){t.q=e,t.fn.getList()})})})}),riot.tag2("modal-remove",'<modal><yield to="title">{app.lang.admin.confirm.tips}</yield><yield to="content">{app.lang.admin.confirm.delete}</yield><yield to="button"><button type="button" onclick="{parent.fn.ok}" class="btn-main">{app.lang.admin.btn.ok}</button></yield><yield to="close">{app.lang.admin.btn.cancel}</yield></modal>',"","",function(e){var t=this;t.fn={ok:function(){t.emit("ok"),t.tags.modal.emit("close")}},t.on("open",function(){t.tags.modal.emit("open")}),t.on("close",function(){t.tags.modal.emit("close")})}),riot.tag2("agreement-select",'<input-select name="agreement_name" ref="agreement_name" placeholder="搜索协议" value=""></input-select><input type="hidden" ref="agreement_id" value=""><input-valid riot-style="{opts.left&&\'left:\'+opts.left+\'px\'}" ref="validAgreement" for="agreement_id" rule="required" msg="请选择协议"></input-valid>',"","",function(e){var t=this;t.keywordCache={},t.getId=function(){return t.refs.agreement_id.value},t.getName=function(){return t.refs.agreement_name.value},t.on("mount",function(){return 1==e.disable?void t.refs.agreement_name.emit("disable"):(t.refs.agreement_name.on("pull",function(e){return t._oldValues={id:t.refs.agreement_id.value||"",agreement_name:t.refs.agreement_name.value||""},t.refs.validAgreement.emit("msg",""),t.keywordCache[e]?t.refs.agreement_name.emit("push",t.keywordCache[e]):void t.app.api("GET","project/agreement/search",{data:{search_type:"agreement_name",search_keyword:e,per_page:99999}}).on("done",function(a){t.keywordCache[e]=a.items,t.refs.agreement_name.emit("push",a.items)})}),void t.refs.agreement_name.on("select",function(e){e.id&&(t._oldValues=e),t.refs.agreement_id.value=e.id||t._oldValues.id,t.refs.agreement_name.value=e.agreement_name||t._oldValues.agreement_name,t.refs.agreement_name.emit("value",t.refs.agreement_name.value)}))}),t.on("check",function(){t.refs.validAgreement.on("valid",function(){t.emit("valid")}).on("invalid",function(){t.emit("invalid")}).emit("check")}),t.on("set",function(e){t.refs.agreement_id.value=e.id,t.refs.agreement_name.emit("value",e.name)})}),riot.tag2("user-select",'<input-select name="real_name" ref="user_name" placeholder="搜索选择用户" value=""></input-select><input type="hidden" ref="user_id" value=""><input-valid riot-style="{opts.left&&\'left:\'+opts.left+\'px\'}" ref="validUser" for="user_id" rule="required" msg="请选择用户"></input-valid>',"","",function(e){var t=this;t.keywordCache={},t.getId=function(){return t.refs.user_id.value},t.getName=function(){return t.refs.user_name.value},t.on("mount",function(){return 1==e.disable?void t.refs.user_name.emit("disable"):(t.refs.user_name.on("pull",function(a){return t._oldValues={user_id:t.refs.user_id.value||"",real_name:t.refs.user_name.value||""},t.refs.validUser.emit("msg",""),t.keywordCache[a]?t.refs.user_name.emit("push",t.keywordCache[a]):void t.app.api("GET","user-manager/default/search",{data:{identity:"admin"==e.for?1:0,keyword:a}}).on("done",function(e){t.keywordCache[a]=e.items,t.refs.user_name&&t.refs.user_name.emit("push",e.items)})}),void t.refs.user_name.on("select",function(e){e.user_id&&(t._oldValues=e),t.refs.user_id.value=e.user_id||t._oldValues.user_id,t.refs.user_name.value=e.real_name||t._oldValues.real_name,t.refs.user_name.emit("value",t.refs.user_name.value),t.emit("select",{user_id:t.refs.user_id.value,real_name:t.refs.user_name.value})}))}),t.on("check",function(){t.refs.validUser.on("valid",function(){t.emit("valid")}).on("invalid",function(){t.emit("invalid")}).emit("check")}),t.on("set",function(e){t.refs.user_id.value=e.id,t.refs.user_name.emit("value",e.name)}),t.on("focus",function(){t.refs.user_name.refs.keyword.focus()})}),riot.tag2("org-select",'<select ref="orgs" each="{id, lv in selectValue}" if="{selectList[id] && selectList[id].length}" onchange="{fn.change}"><option selected="{Number(selectValue[lv+1])===id}" riot-value="{id}" each="{selectList[id]}">{name}</option></select><input type="hidden" ref="org_id" riot-value="{selectValue.slice(-1)[0]}"><input-valid riot-style="{opts.left&&\'left:\'+opts.left+\'px\'}" ref="validOrg" for="org_id" rule="required" msg=""></input-valid>','org-select select,[data-is="org-select"] select{margin-right: 12px}',"",function(e){var t=this;t.orgList=t.app.data.orgList||[],t.selectList={},t.selectValue=[0],t.getId=function(){return t.selectValue.slice(-1)[0]},t.fn={change:function(e){var a=Number(e.item.lv)+1;for(t.refs.validOrg.emit("msg",""),t.selectValue[a]=Number(e.target.value);t.selectValue.length>a+1;)t.selectValue.pop();t.update()},scan:function(e,a,n){var i=e||0,r=a||0,o=[{lv:r,id:-1,name:"--选择结构--"}],s=n||t.orgList;s.forEach(function(e,a){e.child.length>0&&t.fn.scan(e.id,r+1,e.child),o.push({lv:r,id:e.id,name:e.name})}),t.selectList[i]=o}},t.on("mount",function(){return t.orgList.length>0?(t.fn.scan(),t.update()):void t.app.api("GET","system-setting/organization/search").on("done",function(e){t.app.data.orgList=e.items,t.orgList=e.items,t.fn.scan(),t.update()})}),t.on("check",function(){var e=t.selectValue.slice(-1)[0];return t.selectList[e]||e===-1||""==e?(t.emit("invalid"),t.refs.validOrg.emit("msg","请继续选择")):void t.emit("valid")}),t.on("set",function(e){t.selectValue=[0].concat((""+e).split(",")),t.update()})}),riot.tag2("project-select",'<input-select name="name" ref="project" placeholder="搜索项目" value=""></input-select><input type="hidden" ref="project_id" value=""><input-valid riot-style="{opts.left&&\'left:\'+opts.left+\'px\'}" ref="validProject" for="project_id" rule="required" msg="请选择项目"></input-valid>',"","",function(e){var t=this;t.keywordCache={},t.getId=function(){return t.refs.project_id.value},t.getName=function(){return t.refs.project.value},t.on("mount",function(){return 1==e.disable?void t.refs.project.emit("disable"):(t.refs.project.on("pull",function(e){return t._oldValues={id:t.refs.project_id.value||"",name:t.refs.project.value||""},t.refs.validProject.emit("msg",""),t.keywordCache[e]?t.refs.project.emit("push",t.keywordCache[e]):void t.app.api("GET","project/default/search",{data:{keyword:e}}).on("done",function(a){t.keywordCache[e]=a.items,t.refs.project.emit("push",a.items)})}),void t.refs.project.on("select",function(e){e.id&&(t._oldValues=e),t.refs.project_id.value=e.id||t._oldValues.id,t.refs.project.value=e.name||t._oldValues.name,t.refs.project.emit("value",t.refs.project.value)}))}),t.on("check",function(){t.refs.validProject.on("valid",function(){t.emit("valid")}).on("invalid",function(){t.emit("invalid")}).emit("check")}),t.on("set",function(e){t.refs.project_id.value=e.id||"",t.refs.project.value=e.name||"",t.refs.project.emit("value",e.name||"")})}),riot.tag2("project-type-select",'<input-select name="name" ref="project_type" placeholder="搜索项目类型" value=""></input-select><input type="hidden" ref="project_type_id" value=""><input-valid riot-style="{opts.left&&\'left:\'+opts.left+\'px\'}" ref="validProjectType" for="project_type_id" rule="required" msg="请选择项目类型"></input-valid>',"","",function(e){var t=this;t.keywordCache={},t.getId=function(){return t.refs.project_type_id.value},t.getName=function(){return t.refs.project_type.value},t.on("mount",function(){return 1==e.disable?void t.refs.project_type.emit("disable"):(t.refs.project_type.on("pull",function(e){return t._oldValues={name:t.refs.project_type.value||"",id:t.refs.project_type_id.value||""},t.refs.validProjectType.emit("msg",""),t.keywordCache[e]?t.refs.project_type.emit("push",t.keywordCache[e]):void t.app.api("GET","system-setting/project-type/search",{data:{keyword:e}}).on("done",function(a){t.keywordCache[e]=a.items,t.refs.project_type.emit("push",a.items)})}),void t.refs.project_type.on("select",function(e){e.id&&(t._oldValues=e),t.refs.project_type_id.value=e.id||t._oldValues.id,t.refs.project_type.value=e.name||t._oldValues.name,t.refs.project_type.emit("value",t.refs.project_type.value)}))}),t.on("check",function(){t.refs.validProjectType.on("valid",function(){t.emit("valid")}).on("invalid",function(){t.emit("invalid")}).emit("check")}),t.on("set",function(e){var a=t.refs.project_type_id.value=e.id;t.app.api("GET","system-setting/project-type/search").on("done",function(e){e.items.forEach(function(e){e.id==a&&t.refs.project_type&&t.refs.project_type.emit("value",e.name)})})})}),riot.tag2("role-select",'<input-select name="description" ref="description" placeholder="搜索选择角色" value=""></input-select><input type="hidden" ref="name" value=""><input-valid riot-style="{opts.left&&\'left:\'+opts.left+\'px\'}" ref="validRole" for="name" rule="required" msg="请选角色"></input-valid>',"","",function(e){var t=this;t.keywordCache={},t.getDescription=function(){return t.refs.description.value},t.getName=function(){return t.refs.name.value},t.on("mount",function(){t.refs.description.on("pull",function(e){return t._oldValues={name:t.refs.name.value||"",description:t.refs.description.value||""},t.refs.validRole.emit("msg",""),t.keywordCache[e]?t.refs.description.emit("push",t.keywordCache[e]):void t.app.api("GET","role-manager/default/search",{data:{keyword:e}}).on("done",function(a){t.keywordCache[e]=a.items,t.refs.description.emit("push",a.items)})}),t.refs.description.on("select",function(e){e.name&&(t._oldValues=e),t.refs.name.value=e.name||t._oldValues.name,t.refs.description.value=e.description||t._oldValues.description,t.refs.description.emit("value",t.refs.description.value)})}),t.on("check",function(){t.refs.validRole.on("valid",function(){t.emit("valid")}).on("invalid",function(){t.emit("invalid")}).emit("check")}),t.on("set",function(e){t.refs.name.value=e.name,t.refs.description.value=e.description,t.refs.description.emit("value",e.description||" ")})}),riot.tag2("place-select",'<input-select name="place_name" ref="place_name" placeholder="搜索选择职务" value=""></input-select><input type="hidden" ref="place_id" value=""><input-valid riot-style="{opts.left&&\'left:\'+opts.left+\'px\'}" ref="validPlace" for="place_id" rule="required" msg="请选择职务"></input-valid>',"","",function(e){var t=this;t.keywordCache={},t.getId=function(){return t.refs.place_id.value},t.getName=function(){return t.refs.place_name.value},t.on("mount",function(){t.refs.place_name.emit("value",e.place_name||""),t.refs.place_name.on("pull",function(e){return t._oldValues={id:t.refs.place_id.value||"",place_name:t.refs.place_name.value||""},t.refs.validPlace.emit("msg",""),t.keywordCache[e]?t.refs.place_name.emit("push",t.keywordCache[e]):void t.app.api("GET","system-setting/place/search",{data:{keyword:e}}).on("done",function(a){t.keywordCache[e]=a.items,t.refs.place_name.emit("push",a.items)})}),t.refs.place_name.on("select",function(e){e.id&&(t._oldValues=e),t.refs.place_id.value=e.id||t._oldValues.id,t.refs.place_name.value=e.place_name||t._oldValues.place_name,t.refs.place_name.emit("value",t.refs.place_name.value)})}),t.on("check",function(){t.refs.validPlace.on("valid",function(){t.emit("valid")}).on("invalid",function(){t.emit("invalid")}).emit("check")}),t.on("set",function(e){t.refs.place_id.value=e.id,t.refs.place_name.value=e.name,t.refs.place_name.emit("value",e.name||" ")})}),riot.tag2("donor-select",'<input-select name="donor_name" ref="donor_name" placeholder="搜索捐赠方"></input-select><input type="hidden" ref="donor_id" value=""><input-valid riot-style="{opts.left&&\'left:\'+opts.left+\'px\'}" ref="validDonor" for="donor_id" rule="required" msg="请选择捐赠方"></input-valid>',"","",function(e){var t=this;t.keywordCache={},t.getId=function(){return t.refs.donor_id.value},t.on("mount",function(){t.refs.donor_name.on("pull",function(e){return t._oldValues={id:t.refs.donor_id.value||"",name:t.refs.donor_name.value||""},t.refs.validDonor.emit("msg",""),t.keywordCache[e]?t.refs.donor_name.emit("push",t.keywordCache[e]):void t.app.api("GET","donor/default/search",{data:{keyword:e}}).on("done",function(a){t.keywordCache[e]=a.items,t.refs.donor_name.emit("push",a.items)})}),t.refs.donor_name.on("select",function(e){e.id&&(t._oldValues=e),t.refs.donor_id.value=e.id||t._oldValues.id,t.refs.donor_name.value=e.donor_name||t._oldValues.name,t.refs.donor_name.emit("value",t.refs.donor_name.value)})}),t.on("check",function(){t.refs.validDonor.on("valid",function(){t.emit("valid")}).on("invalid",function(){t.emit("invalid")}).emit("check")}),t.on("set",function(e){t.refs.donor_id.value=e.id,t.refs.donor_name.value=e.name,t.refs.donor_name.emit("value",e.name||"")})}),riot.tag2("admin-sidenav",'<ul><li each="{m in data}"><a href="{m.child?\'javascript:;\':\'#!\'+m.url}" onclick="{fn.toggle}" class="{active: new RegExp(m.url).test(parent.url)}"><i class="icon-{m.icon}"></i> {m.name} <i class="{\'icon-menu\': m.child==parent.child,         \'icon-angle-down\': m.child&&parent.child!=m.child}" if="{m.child}"></i></a><ul if="{m.child}" class="child {unfold: parent.child==m.child}"><li each="{s in m.child}"><a href="#!{s.url}" class="{active: new RegExp(s.url).test(parent.url)}"><i class="icon-{s.icon}"></i> {s.name} </a></li></ul></li></ul>','admin-sidenav .child,[data-is="admin-sidenav"] .child{display: none} admin-sidenav .unfold,[data-is="admin-sidenav"] .unfold{display: block} admin-sidenav .icon-angle-down,[data-is="admin-sidenav"] .icon-angle-down,admin-sidenav .icon-menu,[data-is="admin-sidenav"] .icon-menu{float: right; margin-right: 20px; color: #666;}',"",function(e){var t=this;t.data=t.app.lang.admin.sidenav,t.fn={toggle:function(e){e.item.m.child&&(e.item.m.child==t.child?delete t.child:t.child=e.item.m.child)}},t.on("mount",function(){window.scrollTo(0,0),t.url=t.app.route.params[0]||"admin-index",t.app.lang.admin.sidenav.forEach(function(e){new RegExp(e.url).test(t.url)&&e.child&&(t.child=e.child)}),t.update()})}),riot.tag2("table-filter",'<div if="{opts.for==\'daily\'&&app.route.query.range==\'all\'}"> 关键词: <input type="text" ref="keyword" style="width: 250px" riot-value="{keyword}" onclick="this.select()" onkeyup="{fn.enter}" placeholder="输入部门、院系名称进行搜索"><button onclick="{fn.search}" type="button" class="btn-gray"><i class="icon-search"></i></button><a show="{app.route.query.keyword}" href="javascript:;" onclick="{fn.dailyReset}">{app.route.query.keyword}x</a></div><div if="{opts.for==\'project\'}"><a class="tab-sub {active: app.route.query.status==key}" href="javascript:;" onclick="{fn.tab}" each="{projectStatusList}">{name}</a></div><div if="{opts.for==\'agreement\'}"> {app.lang.admin.search.condition}: <select ref="agreement"><option each="{app.lang.admin.agreement[\'search:types\']}" riot-value="{key}" selected="{key==type}">{name}</option></select><input type="text" ref="keyword" riot-value="{keyword}" onclick="this.select()" onkeyup="{fn.enter}" placeholder="{app.lang.admin.search.keyword.placehoder}"><button onclick="{fn.search}" type="button" class="btn-gray"><i class="icon-search"></i></button><a show="{app.route.query.keyword}" href="javascript:;" onclick="{fn.agreementReset}">{app.lang.admin.reset}</a></div><div class="addon"><yield from="addon"></yield></div>',"","",function(e){var t=this;t.projectStatusList=[{name:"全部",key:"all"}].concat(t.app.lang.admin.project["filter:status"]),t.fn={tab:function(e){t.app.route.query.status=e.item.key,t.app.query()},dailyReset:function(){t.app.route.query.keyword="",t.app.query()},agreementReset:function(){return t.refs.agreement.value="agreement_number",t.app.route.query.page=1,t.app.route.query.type=t.app.route.query.page=t.refs.keyword.value=t.app.route.query.keyword="",e.modal?void t.emit("query",t.app.route.query):void t.app.query()},enter:function(e){13==e.keyCode&&t.fn.search()},search:function(){return"daily"===e.for&&(t.app.route.query.keyword=t.refs.keyword.value||""),"agreement"===e.for&&(t.app.route.query.type=t.refs.agreement.value||"",t.app.route.query.keyword=t.refs.keyword.value||""),e.modal?void t.emit("query",t.app.route.query):void t.app.query()}},t.on("mount",function(){"agreement"===e.for&&(t.type=t.app.route.query.type,t.keyword=t.app.route.query.keyword),"daily"===e.for&&(t.keyword=t.app.route.query.keyword),"project"===e.for&&(t.app.route.query.status=t.app.route.query.status||""),t.update()})}),riot.tag2("userinfo",'<div class="username" onmouseenter="{fn.active}" onmouseover="{fn.active}" onmouseleave="{fn.hidden}"><a href="javascript:;" class="{active: active}"> {app.data.user_name} <i class="{\'icon-angle-down\': !active, \'icon-menu\': active}"></i></a><dl class="menu {active: active}" onmouseenter="{fn.active}" onmouseover="{fn.active}" onmouseleave="{fn.hidden}"><dd><a href="#!account">{app.lang.header.userinfo.account}</a></dd><dd><a href="javascript:;" onclick="{fn.logout}">{app.lang.header.userinfo.logout}</a></dd></dl></div>',"","",function(e){var t=this;t.active=!1,t.logoutApi="user"==e.role?"frontend/default/logout":"backend/default/logout",t.infoApi="user"==e.role?"frontend/default/user-info":"backend/default/user-info",t.fn={logout:function(e){t.app.api("GET",t.logoutApi,{trigger:e.target}).on("done",function(e){t.app.utils.cookie.remove("user_name"),t.app.utils.cookie.remove("user_id"),t.app.utils.cookie.remove("role"),t.app.alert(t.app.lang.login.out,"success"),t.app.route(t.app.config.loginPage)})},active:function(){clearTimeout(t.timer),t.active=!0},hidden:function(){clearTimeout(t.timer),t.timer=setTimeout(function(){t.active=!1,t.update()},800)}},t.on("mount",function(){t.app.utils.cookie.get("user_name")?(t.app.data.user_name=t.app.utils.cookie.get("user_name"),t.app.data.user_id=t.app.utils.cookie.get("user_id")):t.app.api("GET",t.infoApi).on("done",function(e){t.app.data.user_name=e.user_name,t.app.data.user_id=e.user_id,t.app.utils.cookie.set("user_name",e.user_name),t.app.utils.cookie.set("user_id",e.user_id),t.update()}),t.update()})}),riot.tag2("footer",'<div class="container"><p class="info"> {app.lang.footer.icp} &copy; {app.lang.footer.copyright} &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {app.lang.footer.address} &nbsp;&nbsp;&nbsp;&nbsp; {app.lang.footer.tel} </p></div>',"","",function(e){var t=this;t.on("mount",function(){var e=document.getElementsByTagName("input")||[];for(var t in e)e[t].maxLength===-1&&(e[t].maxLength=50)})}),riot.tag2("header",'<alert></alert><div class="container {center: opts.for!==\'admin\'}"><div class="row" if="{opts.for===\'login\'}"><h1> {app.lang.header.sitename} </h1></div><div class="row" if="{opts.for===\'user\'}"><h1> {app.lang.header.sitename} </h1><userinfo role="user"></userinfo></div><div class="row" if="{opts.for===\'admin\'}"><h1> {app.lang.header.sitename} </h1><userinfo role="admin"></userinfo></div></div>',"",'class="{opts.for}"',function(e){var t=this;t.alert={},t.on("mount",function(){document.body.setAttribute("class",e.for)}),t.app.off("alert").on("alert",function(e,a){t.tags.alert&&t.tags.alert.emit("message",e,a)})}),riot.tag2("raw","","","",function(e){var t=this;t.fn={},t.on("mount",function(){t.root.innerHTML=e.content})}),riot.tag2("alert",'<p each="{m in message}" class="{center: message.length==1}"><i show="{type==\'error\'&&message.length==1}" class="icon-cancel"></i><i show="{type==\'success\'&&message.length==1}" class="icon-ok"></i><span>{m}</span></p>','alert .center,[data-is="alert"] .center{text-align: center;}','class="{type}"',function(e){var t=this;t.type=e.type,t.on("mount",function(){}),t.on("message",function(e,a){var n=[];if(t.root.style.display="block","object"==typeof e)for(var i in e)n.push(i+":"+e[i]);else n.push(e);clearTimeout(t.timer),t.timer=setTimeout(function(){t.root.style.display="none",t.update({message:null,type:null})},2900),t.update({message:n,type:a||"info"})})}),riot.tag2("input-select",'<div class="input-select"><input ref="keyword" type="text" riot-value="{inputValue}" placeholder="{opts.placeholder}" onclick="{fn.pull}" onkeyup="{fn.keyup}" onblur="{fn.blur}"><ul ref="list" show="{items&&items.length > 0}"><li each="{item, i in items}" class="{active: i==selectIndex-1}" onclick="{fn.select}"> {item[parent.opts.name]} </li></ul></div>','input-select .input-select,[data-is="input-select"] .input-select{ display: inline-block; position: relative; } input-select .input-select ul,[data-is="input-select"] .input-select ul{ padding: 0; position: absolute; list-style: none; }',"",function(e){var t=this;t.selected={},t.selectIndex=0,t.inputValue=e.value,t.displayNum=e.num||6,t.fn={blur:function(e){setTimeout(function(){0===Object.keys(t.selected).length&&(clearTimeout(t.timer),t.update({selected:{},selectIndex:0,items:[]}),t.emit("select",t.selected))},200)},pull:function(e){e.target.value="",t.emit("pull",e.target.value)},select:function(a){a.item.item.id!==-1&&(t.selected=a.item.item,t.refs.keyword.value=t.selected[e.name],t.selectIndex=0,t.items=[],t.emit("select",t.selected))},keyup:function(a){if(clearTimeout(t.timer),27==a.keyCode&&t.fn.blur(a),38==a.keyCode&&t.selectIndex>0)return t.items.length-t.displayNum+1>=t.selectIndex&&(t.refs.list.scrollTop-=t.refs.keyword.clientHeight-3),t.selectIndex--;if(40==a.keyCode&&t.items&&t.selectIndex<t.items.length)return t.displayNum<=t.selectIndex&&(t.refs.list.scrollTop+=t.refs.keyword.clientHeight-3),t.selectIndex++;if(13==a.keyCode&&t.selectIndex>0){if(t.selected=t.items[t.selectIndex-1],t.selected.id===-1)return;return t.refs.keyword.value=t.selected[e.name],t.selectIndex=0,delete t.items,t.emit("select",t.selected)}t.timer=setTimeout(function(){t.emit("pull",a.target.value)},500)}},t.on("mount",function(){}),t.on("push",function(a){a&&0!==a.length||(a=[{}],a[0][e.name]="没搜到请更换关键字",a[0].id=-1),t.update({items:a,selected:{}})}),t.on("value",function(e){t.refs.keyword.value=e}),t.on("disable",function(){t.refs.keyword.disabled=!0})}),riot.tag2("modal",'<div if="{open}" class="modal-container {animation: open}" riot-style="width: {opts.w||360}px; height: {opts.h||200}px; z-index: {opts.z?Number(opts.z)+11:22}; top: {opts.top||\'30%\'}; margin-left: {opts.w?\'-\'+Number(opts.w/2):-180}px"><div class="header"><h3><yield from="title"></yield></h3><a href="javascript:;" onclick="{fn.close}"><i class="icon-cancel"></i></a></div><div class="content"><yield from="content"></yield></div><div class="btn-group"><yield from="button"></yield><button type="button" class="btn-gray" onclick="{fn.close}"><yield from="close"></yield></button></div></div><div if="{open}" onclick="{fn.close}" riot-style="opacity: {opts.mask}; z-index: {opts.z||11}" class="modal-mask"></div>','modal .modal-mask,[data-is="modal"] .modal-mask{ position: fixed; top: 0; left: 0; height: 100%; width: 100%; background: #000; opacity: .4; } modal .modal-container,[data-is="modal"] .modal-container{ position: fixed; left: 50%; box-shadow: 0 0 10px #666; background: #fff; border-radius: 5px; } modal .header,[data-is="modal"] .header{ height: 40px; border-bottom: 1px solid #ebebeb; position: relative; } modal .header h3,[data-is="modal"] .header h3{ text-align: center; line-height: 40px; height: 40px; padding: 0; margin: 0; } modal .header a,[data-is="modal"] .header a{ position: absolute; right: 15px; top: 13px; font-size: 14px; color: #ccc; } modal .header a:hover,[data-is="modal"] .header a:hover{ border: none } modal .content,[data-is="modal"] .content{ text-align: center; padding: 20px; min-height: 60px; } modal .btn-group,[data-is="modal"] .btn-group{ height: 50px; width: 100%; text-align: center; position: absolute; bottom: 0; } modal .btn-group button,[data-is="modal"] .btn-group button{ width: 90px; margin: 0 15px; } modal .animation,[data-is="modal"] .animation{ animation: fadeInDown .3s; }',"",function(e){var t=this;t.open=!1,t.fn={close:function(){t.update({open:!1})}},t.on("open",function(){t.open=!0,document.addEventListener("keydown",function(e){27==e.keyCode&&t.fn.close()},{once:!0}),t.update()}),t.on("close",function(){t.fn.close()})}),riot.tag2("spinner-dot",'<div class="spinner" riot-style="margin-top: {opts.top||0}px"><div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></div>','spinner-dot .spinner,[data-is="spinner-dot"] .spinner{ width: 100%; text-align: center; } spinner-dot .spinner > div,[data-is="spinner-dot"] .spinner > div{ width: 14px; height: 14px; background-color: #ccc; border-radius: 100%; display: inline-block; -webkit-animation: sk-bouncedelay 1.4s infinite ease-in-out both; animation: sk-bouncedelay 1.4s infinite ease-in-out both; } spinner-dot .spinner .bounce1,[data-is="spinner-dot"] .spinner .bounce1{ -webkit-animation-delay: -0.32s; animation-delay: -0.32s; } spinner-dot .spinner .bounce2,[data-is="spinner-dot"] .spinner .bounce2{ -webkit-animation-delay: -0.16s; animation-delay: -0.16s; } @-webkit-keyframes sk-bouncedelay { 0%, 80%, 100% { -webkit-transform: scale(0) } 40% { -webkit-transform: scale(1.0) } } @keyframes sk-bouncedelay { 0%, 80%, 100% { -webkit-transform: scale(0); transform: scale(0); } 40% { -webkit-transform: scale(1.0); transform: scale(1.0); } }',"",function(e){}),riot.tag2("input-valid","<span>{message}</span>","","",function(e){var t=this;t.fn={focusFn:function(){t.update({message:""})},fetchValues:function(){t.target=[];try{for(var a in e.for.split(","))t.target[a]=t.parent.refs[e.for.split(",")[a]],t.target[a]instanceof Array&&(t.target[a]=t.target[e.index||0]);if("undefined"==typeof t.target[0])throw new Error}catch(e){return t.update({message:"属性for所指定的校验对象没找到."})}if("undefined"==typeof t.target[0])return t.update({message:"属性for所指定的校验对象没找到."});if(!e.rule&&!e.reg)return t.update({message:"请指定校验规则，添加rule或reg属性."});for(var a in t.target)t.target[a]instanceof Array?t.target[a].forEach(function(e){e.addEventListener("focus",t.fn.focusFn,{once:!0})}):t.target[a].addEventListener("focus",t.fn.focusFn,{once:!0})}},this.on("mount",function(){}),t.on("check",function(){if(t.invalid=!1,t.fn.fetchValues(),e.rule||(e.rule=""),e.rule.split(",").indexOf("required")!==-1)for(var a in t.target)""===t.target[a].value.replace(/\s/g,"")&&(t.invalid=!0);if(!t.invalid&&e.rule.split(",").indexOf("number")!==-1)for(var a in t.target)Number(t.target[a].value)!=t.target[a].value&&(t.invalid=!0);if(!t.invalid&&e.rule.split(",").indexOf("+int")!==-1)for(var a in t.target)parseInt(t.target[a].value,10)<1&&(t.invalid=!0);if(!t.invalid&&e.rule.split(",").indexOf("email")!==-1)for(var a in t.target)/[^@]+@[^@]+\.[^@]+/.test(t.target[a].value)===!1&&(t.invalid=!0);if(!t.invalid&&e.reg){var n=new RegExp(e.reg,e.flag);for(var a in t.target)t.invalid=n.test(t.target[a].value)===!1}t.invalid?(t.emit("invalid",t.target),t.update({message:e.msg})):t.emit("valid",t.target)}),t.on("msg",function(e){t.update({message:e})})}),riot.tag2("upload-formdata",'<input if="{!disable}" type="file" onchange="{fn.uploadOnChange}" name="{name}" ref="fileInput" multiple><button type="button" ref="btn" onclick="{fn.upload}" disabled="{disable}">{btnText}</button>',"","",function(e){var t=this;t.name=e.name||"file",t.btnText=e.btn||"上传",t.uploadFiles=[],t.disable=e.disable,t.fn={uploadOnChange:function(){e.changeupload&&t.fn.upload(t.refs.btn)},upload:function(e){if(t.uploadFiles=t.refs.fileInput.files,t.progressList=[],!t.uploadFiles.length)return e.target.innerText="请选择文件",setTimeout(function(){e.target.innerText=t.btnText},1e3);var a=document.createElement("form");a.name="file",a.enctype="multipart/form-data",t.fd=new FormData(a);for(var n=0;n<t.uploadFiles.length;n++)t.fd.append(t.name,t.uploadFiles[n]);t.emit("post",t.fd)}},t.on("mount",function(){"FormData"in window==!1&&alert("Your browser not support FormData!")}),t.on("setBtnText",function(e){t.refs.btn.innerText=e}),t.on("disable",function(e){t.disable=e,t.update()})}),riot.tag2("pagination-number",'<ul class="pagination"><li show="{hasPrevPage}"><a href="javascript:;" onclick="{fn.jumpPage}">1</a></li><li show="{hasPrevPage}"><a href="javascript:;" onclick="{fn.prevPage}"> &lt; </a></li><li show="{hasPrevSpan}">...</li><li each="{p in prevPages}"><a href="javascript:;" onclick="{fn.jumpPage}">{p}</a></li><li class="active"><a href="javascript:;">{page}</a></li><li each="{p in nextPages}"><a href="javascript:;" onclick="{fn.jumpPage}">{p}</a></li><li show="{hasNextSpan}">...</li><li if="{hasNextPage}"><a href="javascript:;" onclick="{fn.nextPage}"> &gt; </a></li><li show="{hasNextPage}"><a href="javascript:;" onclick="{fn.jumpPage}">{pages}</a></li><li class="select" if="{opts.select==\'y\'}"> 跳转至 <span if="{pageList.length<100}"><select onchange="{fn.jumpPage}"><option each="{p in pageList}" riot-value="{p}" selected="{p==page}">{p}</option></select></span><input if="{pageList.length>=100}" onchange="{fn.jumpPage}" riot-value="{page}" type="{\'number\'}"> / {pages}页 </li></ul>',"","",function(e){
var t=this;t.pageSpan=4,t.pageList=[],t.fn={pageList:function(){t.pageList=[];for(var e=1;e<=t.pages;e++)t.pageList.push(e)},prevPages:function(){var e=t.pageSpan;for(t.hasPrevSpan=t.page-t.pageSpan>0,t.prevPages=[];e--;)t.page-e>1&&e>0&&t.prevPages.push(t.page-e);t.update()},nextPages:function(){var e=0;for(t.hasNextSpan=t.page+t.pageSpan<t.pages,t.nextPages=[];++e<t.pageSpan;)t.page+e<t.pages&&t.nextPages.push(t.page+e);t.update()},jumpPage:function(e){t.fn.page(Number(e.item?e.item.p:e.target.value||e.target.innerText))},prevPage:function(){t.hasPrevPage&&t.fn.page(t.page-1)},nextPage:function(){t.hasNextPage&&t.fn.page(t.page+1)},pageCount:function(){t.hasNextPage=t.pages>t.page,t.hasPrevPage=t.page>1,t.fn.prevPages(),t.fn.nextPages()},page:function(e){t.page=e,t.fn.pageCount(),t.emit("change",e)},render:function(){t.page=Number(e.page||1),t.pages=Number(e.pages||1),t.fn.pageList(),t.fn.pageCount(),t.update()}},t.on("mount",function(){t.fn.render()}),t.on("render",t.fn.render)});